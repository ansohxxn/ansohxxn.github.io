---
title:  "Unity Chapter 11-6. ì¢€ë¹„ TPS ê²Œì„ ë§Œë“¤ê¸° : Player Movement" 

categories:
  -  Unity Lesson 1 
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-07-15
last_modified_at: 2020-07-15
---

ì¸í”„ëŸ°ì— ìˆëŠ” ì´ì œë¯¼ë‹˜ì˜ **ë ˆíŠ¸ë¡œì˜ ìœ ë‹ˆí‹° C# ê²Œì„ í”„ë¡œê·¸ë˜ë° ì—ì„¼ìŠ¤** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ [ë ˆíŠ¸ë¡œì˜ ìœ ë‹ˆí‹° C# ê²Œì„ í”„ë¡œê·¸ë˜ë° ì—ì„¼ìŠ¤] ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸°!](https://www.inflearn.com/course/%EC%9C%A0%EB%8B%88%ED%8B%B0-%EA%B2%8C%EC%9E%84-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EC%97%90%EC%84%BC%EC%8A%A4)
{: .notice--warning}

<br>

# Chapter 11. ì¢€ë¹„ TPS ê²Œì„ ë§Œë“¤ê¸° 

## ğŸ“œPlayerMovement.cs

> í”Œë ˆì´ì–´ì˜ <u>ì…ë ¥ì— ë”°ë¼ í”Œë ˆì´ì–´ë¥¼ ì›€ì§ì¸ë‹¤.</u> ì…ë ¥ì„ ê°ì§€í•˜ëŠ”ê±´ ğŸ“œPlayerInput.csê°€ í•˜ê¸° ë•Œë¬¸ì— <u>ì…ë ¥ì„ ê°ì§€í•˜ëŠ” ë¶€ë¶„ì€ ë¹ ì ¸ìˆë‹¤.</u> 

```c#
using UnityEngine;

public class PlayerMovement : MonoBehaviour
{
    private CharacterController characterController;
    private PlayerInput playerInput;
    private Animator animator;
    
    private Camera followCam;
    
    public float speed = 6f;
    public float jumpVelocity = 20f;
    [Range(0.01f, 1f)] public float airControlPercent;

    public float speedSmoothTime = 0.1f;
    public float turnSmoothTime = 0.1f;
    
    private float speedSmoothVelocity;
    private float turnSmoothVelocity;
    
    private float currentVelocityY;
    
    public float currentSpeed =>
        new Vector2(characterController.velocity.x, characterController.velocity.z).magnitude;
    
    private void Start()
    {
        animator = GetComponent<Animator>();
        playerInput = GetComponent<PlayerInput>();
        followCam = Camera.main;
        characterController = GetComponent<CharacterController>();
    }

    private void FixedUpdate()
    {
        if (currentSpeed > 0.2f || playerInput.fire) Rotate();

        Move(playerInput.moveInput);
        
        if (playerInput.jump) Jump();
    }

    private void Update()
    {
        UpdateAnimation(playerInput.moveInput);
    }

    public void Move(Vector2 moveInput)
    {
        var targetSpeed = speed * moveInput.magnitude;
        var moveDirection = Vector3.Normalize(transform.forward * moveInput.y + transform.right * moveInput.x);
        
        var smoothTime = characterController.isGrounded ? speedSmoothTime : speedSmoothTime / airControlPercent;

        targetSpeed = Mathf.SmoothDamp(currentSpeed, targetSpeed, ref speedSmoothVelocity, smoothTime);
        currentVelocityY += Time.deltaTime * Physics.gravity.y;

        var velocity = moveDirection * targetSpeed + Vector3.up * currentVelocityY;

        characterController.Move(velocity * Time.deltaTime);

        if (characterController.isGrounded) currentVelocityY = 0;
    }

    public void Rotate()
    {
        var targetRotation = followCam.transform.eulerAngles.y;

        transform.eulerAngles = Vector3.up * Mathf.SmoothDampAngle(transform.eulerAngles.y, targetRotation,
                                    ref turnSmoothVelocity, turnSmoothTime);
    }

    public void Jump()
    {
        if (!characterController.isGrounded) return;
        currentVelocityY = jumpVelocity;
    }

    private void UpdateAnimation(Vector2 moveInput)
    {
        var animationSpeedPercent = currentSpeed / speed;

        animator.SetFloat("Horizontal Move", moveInput.x * animationSpeedPercent, 0.05f, Time.deltaTime);
        animator.SetFloat("Vertical Move", moveInput.y * animationSpeedPercent, 0.05f, Time.deltaTime);
    }
}
```

<br>

### ë©¤ë²„ ë³€ìˆ˜

```c#
    private CharacterController characterController;
    private PlayerInput playerInput;
    private Animator animator;
    
    private Camera followCam;
    
    public float speed = 6f;
    public float jumpVelocity = 20f;
    [Range(0.01f, 1f)] public float airControlPercent;

    public float speedSmoothTime = 0.1f;
    public float turnSmoothTime = 0.1f;
    
    private float speedSmoothVelocity;
    private float turnSmoothVelocity;
    
    private float currentVelocityY;
    
    public float currentSpeed =>
        new Vector2(characterController.velocity.x, characterController.velocity.z).magnitude;
```

- `characterController`
  - CharacterController ì»´í¬ë„ŒíŠ¸
    - ì´ ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•´ `Player Character` ì˜¤ë¸Œì íŠ¸ì˜ Collider ì²˜ë¦¬
- `playerInput`
  - ğŸ“œPlayerInput.cs ìŠ¤í¬ë¦½íŠ¸
    - ì–˜ë¡œë¶€í„° ì…ë ¥ ê°ì§€ë¥¼ ë°›ì•„ì•¼ í•¨
- `Animator`
  - Animator ì»´í¬ë„ŒíŠ¸
    - ì´ ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•´ `Player Character` ì˜¤ë¸Œì íŠ¸ì˜ ì• ë‹ˆë©”ì´ì…˜ì„ ì œì–´
- `followCam`
  - Camera ì»´í¬ë„ŒíŠ¸
    - Main Camera (Brain Camera)
    - í”Œë ˆì´ì–´ê°€ ì›€ì§ì¼ë•Œ ì¹´ë©”ë¼ì˜ ë°©í–¥ì„ ê¸°ì¤€ìœ¼ë¡œ ì›€ì§ì´ê²Œ ë˜ë¯€ë¡œ í˜„ì¬ ì¹´ë©”ë¼ì˜ ë°©í–¥ì„ ì•Œê¸° ìœ„í•´ì„œ í•„ìš”.
- `speed`
  - ì›€ì§ì„ ì†ë„  (ì´ˆë‹¹ 6)
- `jumpVelocity`
  - ì í”„í•˜ëŠ” ìˆœê°„ì— ì‚¬ìš©ë  ì†ë„ (ì´ˆë‹¹ 20) 
- `airControlPercent`
  - ì í”„í•´ì„œ í”Œë ˆì´ì–´ê°€ ê³µì¤‘ì— ì²´ë¥˜í•˜ëŠ” ë™ì•ˆ ì›ë˜ ì†ë„ì˜ ëª‡ í¼ì„¼íŠ¸ì˜ ì†ë„ë¥¼ í†µì œí•  ìˆ˜ ìˆì„ì§€ì— ëŒ€í•œ í¼ì„¼íŠ¸.
    - Rangeë¥¼ ì‚¬ìš©í•´ì„œ 0.01 ~ 1 ì‚¬ì´ì˜ ê°’ì„ ìœ ë‹ˆí‹°ì—ì„œ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ í•¨.
  - ì´ ê°’ì´ 0ì´ë©´ í”Œë ˆì´ì–´ê°€ ê³µì¤‘ì— ìˆì„ ë• ì¡°ì‘ì„ í•  ìˆ˜ ì—†ë‹¤.
  - ì´ ê°’ì´ 1ì´ë©´ í”Œë ˆì´ì–´ê°€ ê³µì¤‘ì— ìˆì–´ë„ ì›ë˜ ì†ë„ë¡œ ì¡°ì‘í•  ìˆ˜ ìˆë‹¤.
- `speedSmoothTime`
  - ì´ë™í•˜ëŠ”ë° ìˆì–´ ìŠ¤ë¬´ìŠ¤í•˜ê²Œ ëŒí•‘í•˜ëŠ” ì§€ì—° ì‹œê°„
- `turnSmoothTime`
  - íšŒì „í•˜ëŠ”ë° ìˆì–´ ìŠ¤ë¬´ìŠ¤í•˜ê²Œ ëŒí•‘í•˜ëŠ” ì§€ì—° ì‹œê°„
- `speedSmoothVelocity`
  - Mathfì˜ SmoothDamp í•¨ìˆ˜ë¥¼ ì‚¬ìš©í• ë•Œ ìŠ¤ë¬´ìŠ¤í•˜ê²Œ ë³€í™”í•˜ëŠ” ê°’ì„ ê³„ì†í•´ì„œ ë¦¬í„´í•˜ê¸° ë•Œë¬¸ì— ê·¸ ê°’ì„ ë°›ê¸° ìœ„í•´ ì„ ì–¸.
- `turnSmoothVelocity`
  - Mathfì˜ SmoothDamp í•¨ìˆ˜ë¥¼ ì‚¬ìš©í• ë•Œ ìŠ¤ë¬´ìŠ¤í•˜ê²Œ ë³€í™”í•˜ëŠ” ê°’ì„ ê³„ì†í•´ì„œ ë¦¬í„´í•˜ê¸° ë•Œë¬¸ì— ê·¸ ê°’ì„ ë°›ê¸° ìœ„í•´ ì„ ì–¸.
- `currentVelocityY`
  - í”Œë ˆì´ì–´ì˜ Y ë°©í–¥ ì†ë„ 
    - Rigidbodyì™€ ë‹¬ë¦¬ Character Controller ì»´í¬ë„ŒíŠ¸ëŠ” ì™¸ë¶€ì˜ ë¬¼ë¦¬ì ì¸ í˜ì„ ë°›ì§€ ì•Šìœ¼ë¯€ë¡œ <u>ì¤‘ë ¥ì„ ë°›ì•„ ë–¨ì–´ì§€ì§€ ì•Šê¸° ë•Œë¬¸ì— ê°œë°œìê°€ ì§ì ‘ Y ë°©í–¥ ì†ë„ë¥¼ ì¡°ì •í•´ì•¼ í•œë‹¤.</u>
- `currentSpeed`
  - Yë¥¼ ì œì™¸í•œ X, Z ë°©í–¥ì—ì„œì˜ ì†ë„. ì¦‰, <u>í”Œë ˆì´ì–´ì˜ ì§€ë©´ ìƒì—ì„œì˜ í˜„ì¬ ì†ë„.</u>
    - **get í”„ë¡œí¼í‹°** ì¸ë° ëŒë‹¤ì‹ìœ¼ë¡œ `=>`ì„ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ í‘œí˜„í–ˆë‹¤. 
      - `currentSpeed`ì„ ë¦¬í„´í•˜ë ¤ê³  í•  ë• (Xì†ë„, Zì†ë„) ë²¡í„°2ì˜ ê¸¸ì´ê°€ ë¦¬í„´ë˜ê²Œ ëœë‹¤.
      - [í”„ë¡œí¼í‹° ëŒë‹¤ í•¨ìˆ˜ ì°¸ê³ ](https://ansohxxn.github.io/unity%20lesson%201/chapter8-5/#%EC%98%88%EC%A0%9C-2--%ED%94%84%EB%A1%9C%ED%8D%BC%ED%8B%B0)

***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}

<br>