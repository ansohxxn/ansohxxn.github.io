---
title:  "Ch 5. íë¸Œ(í”Œë ˆì´ì–´)ì˜ ì›€ì§ì„, íšŒì „, ë°˜ë™" 

categories:
  -  Unity Lesson 4
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2021-01-16
last_modified_at: 2020-01-16
---

ì¼€ì´ë””ë‹˜ì˜ **[ìœ ë‹ˆí‹° ê°•ì¢Œ] ë¦¬ë“¬ ê²Œì„** ìœ íŠœë¸Œ ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.youtube.com/watch?v=eLdiOCWPfPc&list=PLUZ5gNInsv_MCnum4bOQRI72LdGkIY3tY&index=2&t=231s)
{: .notice--warning}

## ğŸ“œPlayerController

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerController : MonoBehaviour
{
    // ì´ë™
    [SerializeField] float moveSpeed = 3;   // 1ì´ˆì— 3ë§Œí¼ ì›€ì§ì´ë„ë¡
    Vector3 dir = new Vector3();
    Vector3 destPos = new Vector3();

    // íšŒì „
    [SerializeField] float spinSpeed = 270f;  // 270ë„ 
    Vector3 rotDir = new Vector3();
    Quaternion destRot = new Quaternion();

    bool canMove = true; // ì¿ ë¸Œ ì´ë™ì¤‘ì—ëŠ” ë…¸íŠ¸ íŒì •ì´ ë¶ˆê°€ëŠ¥ í•˜ë„ë¡ (ì½”ë£¨í‹´ ì¤‘ë³µ ì‹¤í–‰ ì°¨ë‹¨)
    
    // ìˆ˜ì§ ë°˜ë™
    [SerializeField] float recoilPosY = 0.25f;
    [SerializeField] float recoilSpeed = 1.5f;

    [SerializeField] Transform fakeCube = null;
    [SerializeField] Transform realCube = null;


    TimingManager theTimingManager;
```

![image](https://user-images.githubusercontent.com/42318591/104831756-088f0f80-58cf-11eb-8357-2de8c963c05b.png)

![image](https://user-images.githubusercontent.com/42318591/104817110-97197780-5862-11eb-85d6-8780fca0282c.png)

```c#
    void Start()
    {
        theTimingManager = FindObjectOfType<TimingManager>();
    }

    void Update()
    {
        if (Input.GetKeyDown(KeyCode.A) || Input.GetKeyDown(KeyCode.D) ||
            Input.GetKeyDown(KeyCode.W) || Input.GetKeyDown(KeyCode.S))
        {
            if (canMove)
            {
                // íŒì • ì²´í¬ : Perfect, Cool, Good, Bad ì¼ ë•Œë§Œ True
                if (theTimingManager.CheckTiming())
                {
                    StartAction();
                }
            }
        }
    }

    void StartAction() // Perfect, Cool, Good, Bad ì¼ ë•Œë§Œ í•œë²ˆ ì‹œë³ã…‡ë¨
    {
        // íë¸Œì˜ xì¶• -> ìœ„ ì•„ë˜   íë¸Œì˜ zì¶• -> ì˜¤ë¥¸ìª½, ì™¼ìª½
        dir.Set(Input.GetAxisRaw("Vertical"), 0, Input.GetAxisRaw("Horizontal"));

        // ì´ë™ ëª©í‘œê°’ ê²Œì‚°
        destPos = transform.position + new Vector3(-dir.x, 0, dir.z);

        // íšŒì „ ëª©í‘œê°’ ê³„ì‚°
        rotDir = new Vector3(-dir.z, 0f, -dir.x);
        fakeCube.RotateAround(transform.position, rotDir, spinSpeed); //ê³µì „
        destRot = fakeCube.rotation;

        StartCoroutine(MoveCo());
        StartCoroutine(SpinCo());
        StartCoroutine(RecoilCo());
    }

    IEnumerator MoveCo()
    {
        canMove = false;
        while(Vector3.SqrMagnitude(transform.position - destPos) >= 0.001f)
        {
            transform.position = Vector3.MoveTowards(transform.position, destPos, moveSpeed * Time.deltaTime); 
            yield return null;
        }

        transform.position = destPos;
        canMove = true;
    }

    IEnumerator SpinCo()
    {
        while(Quaternion.Angle(realCube.rotation, destRot) > 0.5f)
        {
            realCube.rotation = Quaternion.RotateTowards(realCube.rotation, destRot, spinSpeed * Time.deltaTime); 
            yield return null;
        }

        realCube.rotation = destRot;
    }

    IEnumerator RecoilCo()
    {
        // ì˜¬ë¼ê°
        while (realCube.position.y < recoilPosY)
        {
            realCube.position += new Vector3(0, recoilSpeed * Time.deltaTime, 0);
            yield return null;
        }

        // ë‚´ë ¤ê°
        while (realCube.position.y > 0)
        {
            realCube.position -= new Vector3(0, recoilSpeed * Time.deltaTime, 0);
            yield return null;
        }

        realCube.localPosition = new Vector3(0, 0, 0);
    }
}

```

### âœˆ ì¤€ë¹„ ê³¼ì •

> W A S D ì…ë ¥ì´ ë“¤ì–´ ì™”ê³ , í˜„ì¬ íë¸Œê°€ ì´ë™ì¤‘ì¸ ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´ ğŸ‘‰ íë¸Œì˜ ì´ë™ + íšŒì „ + ë°˜ë™ 

```c#
dir.Set(Input.GetAxisRaw("Vertical"), 0, Input.GetAxisRaw("Horizontal"));
```

![image](https://user-images.githubusercontent.com/42318591/104829345-2603af80-58b6-11eb-8862-534db214d7fb.png)

`dir`ì€ ì´ë™, íšŒì „ ì¶•ì— í•„ìš”í•œ Vector3 ë¡œ ì‚¬ìš©í•  ê²ƒ.

- "Horizontal" ğŸ‘‰ `A` í‚¤ ëˆ„ë¥´ë©´ -1, `D` í‚¤ ëˆ„ë¥´ë©´ 1
  - `A`í‚¤ ëˆ„ë¥´ë©´ íë¸Œê°€ Z ì¶•ì˜ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì´ë™í•˜ê³ , `D`í‚¤ ëˆ„ë¥´ë©´ Z ì¶•ìœ¼ë¡œ ì´ë™í•˜ê²Œ í•  ê²ƒì´ë¼ `dir`ì˜ Z ì¶•ì— *Input.GetAxisRaw("Horizontal")* í• ë‹¹.
    - `A` í‚¤ ëˆ„ë¥´ë©´ `dir.z`ëŠ” 1ì´ ë˜ë©°, `D`í‚¤ ëˆ„ë¥´ë©´ `dir.z`ëŠ” -1ì´ ë¨.
- "Vertical" ğŸ‘‰ `S` í‚¤ ëˆ„ë¥´ë©´ -1, `W` í‚¤ ëˆ„ë¥´ë©´ 1
  - `W`í‚¤ ëˆ„ë¥´ë©´ íë¸Œê°€ X ì¶•ì˜ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì´ë™í•˜ê³ , `S`í‚¤ ëˆ„ë¥´ë©´ X ì¶•ìœ¼ë¡œ ì´ë™í•˜ê²Œ í•  ê²ƒì´ë¼ `dir`ì˜ X ì¶•ì— *Input.GetAxisRaw("Vertical")* í• ë‹¹.
    - `S` í‚¤ ëˆ„ë¥´ë©´ `dir.x`ëŠ” 1ì´ ë˜ë©°, `W`í‚¤ ëˆ„ë¥´ë©´ `dir.x`ëŠ” -1ì´ ë¨.
- `dir.y` ìˆ˜ì§ìœ¼ë¡œ ì´ë™í•˜ê±°ë‚˜ y ì¶•ì„ ì¤‘ì‹¬ìœ¼ë¡œ íšŒì „í•˜ì§„ ì•Šì„ ê²ƒì´ë¼ì„œ 0 


```c#
        // ì´ë™ ëª©í‘œê°’ ê²Œì‚°
        destPos = transform.position + new Vector3(-dir.x, 0, dir.z);

        // íšŒì „ ëª©í‘œê°’ ê³„ì‚°
        rotDir = new Vector3(-dir.z, 0f, -dir.x);
        fakeCube.RotateAround(transform.position, rotDir, spinSpeed); //ê³µì „
        destRot = fakeCube.rotation;
```

- `destPos`
  - ëª©í‘œ ìœ„ì¹˜. ì˜ˆë¥¼ ë“¤ì–´ A í‚¤ì™€ W í‚¤ë¥¼ ë™ì‹œì— ëˆŒë €ë‹¤ë©´ (-1, 0, -1) ë§Œí¼ ì´ë™
    - `S`ê°€ Xì¶•ê³¼ ì¼ì¹˜í•˜ê³  `W`ëŠ” Xì¶•ì˜ ë°˜ëŒ€ë¼ `-dir.x` í•´ì¤€ ê²ƒ
- `destRot`
  - ëª©í‘œ íšŒì „ ê°’.
  - ë¨¼ì € ë¹ˆ ì˜¤ë¸Œì íŠ¸ì¸ `fakeCube`ë¥¼ í˜„ì¬ íë¸Œì˜ ìœ„ì¹˜ì˜ `rotDir`ì¶•ì„ ê¸°ì¤€ìœ¼ë¡œ 270ë„ (`spinSpeed`) ë¨¼ì € íšŒì „ ì‹œí‚¨ë‹¤. ì½”ë£¨í‹´ìœ¼ë¡œ ì´ë™, íšŒì „, ë°˜ë™ì„ ì‹¤ì œë¡œ ì‹¤í–‰í•˜ê¸° ì „ì—, ë¨¼ì € `fakeCube`ë¥¼ ìì „ìœ¼ë¡œ íšŒì „ ì‹œì¼œë†”ì„œ ê·¸ íšŒì „ê°’ì„ ì–»ì–´ ë†“ëŠ” ê²ƒì´ë‹¤.
    - ì½”ë£¨í‹´ ìˆœì„œ ìƒ ì´ë™ì´ ë¨¼ì € ì´ë£¨ì–´ì§„ í›„ íšŒì „ì´ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— <u>ì´ë™ ì „ì˜ í˜„ì¬ ìœ„ì¹˜ì˜ ìƒíƒœì—ì„œ ìì „ì—ì„œ íšŒì „í–ˆì„ ë–„ì˜ ê·¸ íšŒì „ê°’ì„ ëª©í‘œë¡œ ì´ë™ í›„ì— íšŒì „ì„ í•´ì•¼ í•˜ë¯€ë¡œ fakeCubeë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ ê·¸ê±¸ ì´ë™ ì „ì— ë¯¸ë¦¬ íšŒì „ì‹œí‚¨ í›„ ìµœì¢…ì ì¸ ê·¸ fakeCubeì˜ ì›”ë“œ íšŒì „ê°’ì„ ëª©í‘œ íšŒì „ê°’ìœ¼ë¡œ ë¯¸ë¦¬ ì €ì¥í•´ë‘ëŠ” ê²ƒì´ë‹¤.</u>
    - `fakeCube`ëŠ” `transform`(ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¶™ëŠ” í”Œë ˆì´ì–´ íë¸Œ)ì™€ ìœ„ì¹˜ê°€ ì¼ì¹˜í•œ ìƒíƒœë‹¤. ê·¸ëŸ¬ë‹ˆ ìì „í•˜ë“¯ íšŒì „í•  ê²ƒì´ë‹¤.

```c#
        StartCoroutine(MoveCo());
        StartCoroutine(SpinCo());
        StartCoroutine(RecoilCo());
```

1. ì´ë™
2. íšŒì „
3. ë°˜ë™ 

<br>

### âœˆ ì´ë™

```c#
    IEnumerator MoveCo()
    {
        canMove = false;
        while(Vector3.SqrMagnitude(transform.position - destPos) >= 0.001f)
        {
            transform.position = Vector3.MoveTowards(transform.position, destPos, moveSpeed * Time.deltaTime); 
            yield return null;
        }

        transform.position = destPos;
        canMove = true;
    }
```

- `canMove` ì´ ì´ë™ ì½”ë£¨í‹´ì„ ì‹¤í–‰ ì¤‘ì¼ ë•ŒëŠ” *StartAction()* ì´ ë˜ í˜¸ì¶œë˜ì§€ ì•Šë„ë¡ í•œë‹¤. 
  - ì•„ì§ ì½”ë£¨í‹´ë“¤ ì‹¤í–‰ì´ ë‹¤ ë§ˆì¹˜ì§€ë„ ì•Šì•˜ëŠ”ë° Perfect íŒì • ëˆŒë ¤ì„œ ë˜ ìƒˆë¡œìš´ ì´ë™ íšŒì „ ë°˜ë™ ì‹¤í–‰ì„ í•´ì•¼ í•˜ë©´ ë²„ë²….. ë¶€ìì—°ìŠ¤ëŸ½..
- ë¶€ë“œëŸ½ê²Œ ë™ì‘í•˜ë„ë¡ í•œ í”„ë ˆì„ì”© ì‰¬ë©´ì„œ(ì½”ë£¨í‹´) `transform.position` í˜„ì¬ ìœ„ì¹˜ê°€ `destPos`ê°€ ë  ë•Œê¹Œì§€ í˜„ì¬ ìœ„ì¹˜ë¥¼ ê²Œì† ì—…ëƒ! 1ì´ˆì— `moveSpeed` ë§Œí¼.
- ì˜¤ì°¨ë¥¼ ë‘ì–´ì„œ whileë¬¸ì„ ëŒë ¸ê¸° ë–„ë¬¸ì— ë‹¤ì‹œ ì œëŒ€ë¡œ `destPos` ë¡œ ì„¸íŒ…

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” `Player`ì— ë¶™ëŠ”ë‹¤. ì¦‰, ì‹¤ì œ `realCube`ì˜ ë¶€ëª¨ ì˜¤ë¸Œì íŠ¸ì´ì ë¹ˆ ë¶€ëª¨ì˜¤ë¸Œì íŠ¸ì— ë¶™ëŠ” ê²ƒì´ë‹¤. ê·¸ë˜ì„œ `transform`ì€ ì‚¬ì‹¤ `Player`ì´ë‹¤. ë¶€ëª¨ì¸ `Player`ë„ í•¨ê»˜ ì´ë™í•˜ê¸° ë–„ë¬¸ì— ë‚˜ì¤‘ì— *ë°˜ë™* ì½”ë£¨í‹´ì„ ë§ˆì¹œ í›„ `realCube`ë¥¼ ë‹¤ì‹œ ì œìë¦¬ë¡œ í•  ë•Œ *realCube.position = Vector3.zero* ê°€ ì•„ë‹Œ, *realCube.localPosition = Vector3.zero* ìœ¼ë¡œ í•  ìˆ˜ ìˆê²Œ ëœë‹¤. ì „ìëŠ” ì›”ë“œ ìƒì˜ ì›ì  ì¢Œí‘œë¡œ ì´ë™í•´ë²„ë¦¬ëŠ” ê²ƒì´ê³  í›„ìëŠ” ë¶€ëª¨ì™€ ìœ„ì¹˜ë¥¼ ì¼ì¹˜ì‹œí‚¤ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤.

<br>

### âœˆ íšŒì „

```c#
    IEnumerator SpinCo()
    {
        while(Quaternion.Angle(realCube.rotation, destRot) > 0.5f)
        {
            realCube.rotation = Quaternion.RotateTowards(realCube.rotation, destRot, spinSpeed * Time.deltaTime); 
            yield return null;
        }

        realCube.rotation = destRot;
    }
```

- ë¶€ë“œëŸ½ê²Œ ë™ì‘í•˜ë„ë¡ í•œ í”„ë ˆì„ì”© ì‰¬ë©´ì„œ(ì½”ë£¨í‹´) `realCube.rotation` íë¸Œì˜ íšŒì „ ê°’ì´ `destRot`ê°€ ë  ë•Œê¹Œì§€ `realCube`ì˜ í˜„ì¬ íšŒì „ê°’ì„ ê²Œì† ì—…ëƒ!  

<br>

### âœˆ ìˆ˜ì§ ë°˜ë™ 

```c#
    IEnumerator RecoilCo()
    {
        // ì˜¬ë¼ê°
        while (realCube.position.y < recoilPosY)
        {
            realCube.position += new Vector3(0, recoilSpeed * Time.deltaTime, 0);
            yield return null;
        }

        // ë‚´ë ¤ê°
        while (realCube.position.y > 0)
        {
            realCube.position -= new Vector3(0, recoilSpeed * Time.deltaTime, 0);
            yield return null;
        }

        realCube.localPosition = new Vector3(0, 0, 0);
    }
```

`y` ë°©í–¥, ì¦‰ ìˆ˜ì§ ë°©í–¥ìœ¼ë¡œ ì‚´ì§ í†µí†µ íŠ€ëŠ” ëŠë‚Œì„ ì£¼ë„ë¡!

- `y` ë°©í–¥ìœ¼ë¡œ ì‚´ ì§ ëœ° ë•Œ
- ë‹¤ì‹œ ì œìë¦¬ë¡œ ë‚´ë ¤ê°ˆ ë•Œ
- ë‹¤ì‹œ ì œìë¦¬ë¡œ í™•ì‹¤íˆ ì„¤ì •
  - *realCube.position* ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ì›”ë“œ ì¢Œí‘œìƒ ì›ì ìœ¼ë¡œ ê°€ê¸° ë•Œë¬¸ì— í•¨ê»˜ ì´ë™í•´ì™“ë˜ ë¶€ëª¨ë¥¼ ê¸°ì¤€ì˜ *localPosition* ì‚¬ìš©.


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}