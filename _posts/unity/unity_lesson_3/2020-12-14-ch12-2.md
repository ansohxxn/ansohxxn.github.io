---
title:  "Chapter 12-2. ê¸°íƒ€ : í¬íƒ‘(Defense Tower) ë§Œë“¤ê¸°" 

categories:
  -  Unity Lesson 3 
tags:
  - [Game Engine, Unity]

toc: true
toc_sticky: true

date: 2020-12-14
last_modified_at: 2020-12-14
---

ì¸í”„ëŸ°ì— ìˆëŠ” ì¼€ì´ë””ë‹˜ì˜ **[ìœ ë‹ˆí‹° 3D] ì‹¤ì „! ìƒì¡´ê²Œì„ ë§Œë“¤ê¸° - Advanced** ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤. ğŸ˜€  
[ğŸŒœ ê°•ì˜ ë“¤ìœ¼ëŸ¬ ê°€ê¸° Click](https://www.inflearn.com/course/unity-2#)
{: .notice--warning}


## ğŸš€ í¬íƒ‘ ì˜¤ë¸Œì íŠ¸

![image](https://postfiles.pstatic.net/MjAyMDEyMTRfOTgg/MDAxNjA3OTMzNTAyNTYw.cn4lt4IJpHB4X7hKHV_tBhWmv0OEFeAa4_fV4nxC9DQg.dLf14Rn6xdvon1p1SjI2xa_Hf5FwgJhFMLCwQ49ALRMg.GIF.sohyune_an/2.gif?type=w773)

![image](https://user-images.githubusercontent.com/42318591/102056458-c128e580-3e2f-11eb-8678-a6e8b4964cee.png)

foundation ë¼ˆëŒ€ ì½œë¼ì´ë” í”Œë ˆì´ì–´ê°€ ê´€í†µ ëª»í•˜ë„ë¡

![image](https://user-images.githubusercontent.com/42318591/102058782-62fe0180-3e33-11eb-940d-86fbfee60dd6.png)

ì„œë¸Œ ë¨¸ì‹ ê±´

![image](https://user-images.githubusercontent.com/42318591/102058825-6e512d00-3e33-11eb-9059-07b43a40d798.png)

Gun Holder

![image](https://user-images.githubusercontent.com/42318591/102058859-7ad58580-3e33-11eb-8bd1-1d792b18b8c3.png)

Top Gun

í¬ì‹ ê³¼ z ì¶•ì´ ì¼ì¹˜í•˜ê²Œ, í”Œë ˆì´ì–´ë¥¼ ë°”ë¼ë³´ëŠ” ë°©í–¥ê³¼ ì¼ì¹˜í•˜ë©´ ë°œí¬

<br>

## ğŸš€ í¬íƒ‘ ì• ë‹ˆë©”ì´ì…˜

### âœˆ ì• ë‹ˆë©”ì´ì…˜ í´ë¦½

![image](https://user-images.githubusercontent.com/42318591/102057361-25987480-3e31-11eb-9d5b-fb95fa4d179f.png)

![image](https://user-images.githubusercontent.com/42318591/102057407-35b05400-3e31-11eb-8b85-4d59d585d459.png)


<br>

### âœˆ ì• ë‹ˆë©”ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ 

![image](https://user-images.githubusercontent.com/42318591/102057530-62646b80-3e31-11eb-8548-0041009ea52b.png)


<br>

## ğŸš€ í¬íƒ‘ ì‘ë™ì‹œí‚¤ê¸°

### ğŸ“œDefenseTower

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class DefenseTower : MonoBehaviour
{
    [SerializeField] private string towerName; // ë°©ì›Œíƒ€ì›Œì˜ ì´ë¦„
    [SerializeField] private float range; // ë°©ì–´íƒ€ì›Œì˜ ì‚¬ì •ê±°ë¦¬
    [SerializeField] private int damage; // ë°©ì–´ íƒ€ì›Œì˜ ê³µê²©ë ¥
    [SerializeField] private float rateOfAccuracy; // ì •í™•ë„(0ì— ê°€ê¹Œìš¸ ìˆ˜ë¡ ì •í™•ë„ ë†’ìŒ)
    [SerializeField] private float rateOfFire; // ì—°ì‚¬ì†ë„(rateOfFireì´ˆë§ˆë‹¤ ë°œì‚¬)
    private float currentRateOfFire; // ì—°ì‚¬ì†ë„ ê³„ì‚°(ê°±ì‹ ë¨)
    [SerializeField] private float viewAngle; // ì‹œì•¼ê°
    [SerializeField] private float spinSpeed; // í¬ì‹  íšŒì „ ì†ë„
    [SerializeField] private LayerMask layerMask; // ì›€ì§ì´ëŠ” ëŒ€ìƒë§Œ íƒ€ê²Ÿìœ¼ë¡œ ì§€ì •(í”Œë ˆì´ì–´ í˜¹ì€ ë™ë¬¼)
    [SerializeField] private Transform tf_TopGun; // í¬ì‹ 
    [SerializeField] private ParticleSystem particle_MuzzleFlash; // ì´êµ¬ ì„¬ê´‘
    [SerializeField] private GameObject go_HitEffect_Prefab; // ì ì¤‘ íš¨ê³¼ ì´í™íŠ¸

    private RaycastHit hitInfo;
    private Animator anim;
    private AudioSource theAudio;

    private bool isFindTarget = false; // ì  íƒ€ê²Ÿ ë°œê²¬ì‹œ True
    private bool isAttack = false; // ì •í™•íˆ íƒ€ê²Ÿì„ í–¥í•´ í¬ì‹  íšŒì „ ì™„ë£Œì‹œ True (ì´êµ¬ ë°©í–¥ê³¼ ì  ë°©í–¥ì´ ì¼ì¹˜í•  ë•Œ)

    private Transform tf_Target; // í˜„ì¬ ì„¤ì •ëœ íƒ€ê²Ÿì˜ íŠ¸ëœìŠ¤í¼

    [SerializeField] private AudioClip sound_Fire;


    void Start()
    {
        theAudio = GetComponent<AudioSource>();
        theAudio.clip = sound_Fire;
        anim = GetComponent<Animator>();
    }

    void FixedUpdate() // ì •í•´ì§„ ì´ˆë§ˆë‹¤ (!= í”„ë ˆì„ë§ˆë‹¤. updateë³´ë‹¤ ì¢€ ëŠë¦¬ê³  ì •í™•)
    {
        Spin();
        SearchEnemy();
        LookTarget();
        Attack();
    }
```

<br>

#### âœˆ í‰ì†Œì—” 360ë„ íšŒì „í•˜ê¸°

```c#
    private void Spin()
    {
        if (!isFindTarget && !isAttack)
        {
            Quaternion _spin = Quaternion.Euler(0f, tf_TopGun.eulerAngles.y + (1f * spinSpeed * Time.deltaTime), 0f);
            tf_TopGun.rotation = _spin;
        }
    }
```

<br>

#### âœˆ íƒ€ê²Ÿ ì°¾ê¸°

```c#
    private void SearchEnemy()
    {
        Collider[] _target = Physics.OverlapSphere(tf_TopGun.position, range, layerMask);

        for (int i = 0; i < _target.Length; i++)
        {
            Transform _targetTf = _target[i].transform; // ì´ê²Œ ë” ë¹ ë¥´ë‹¤

            if (_targetTf.name == "Player")
            {
                Vector3 _direction = (_targetTf.position - tf_TopGun.position).normalized;
                float _angle = Vector3.Angle(_direction, tf_TopGun.forward);
                
                if (_angle < viewAngle * 0.5f)
                {
                    tf_Target = _targetTf;
                    isFindTarget = true;

                    if (_angle < 5f) // ê±°ì˜ ì°¨ì´ ì•ˆë‚˜ë©´
                        isAttack = true;
                    else
                        isAttack = false;
                    
                    return;
                }
            }
        }
        tf_Target = null;
        isAttack = false;
        isFindTarget = false;
    }
```

<br>

#### âœˆ íƒ€ê²Ÿì„ í–¥í•´ íšŒì „í•˜ê¸°

```c#
    private void LookTarget()
    {
        if (isFindTarget)
        {
            Vector3 _direction = (tf_Target.position - tf_TopGun.position).normalized;
            Quaternion _lookRotation = Quaternion.LookRotation(_direction);
            Quaternion _rotation = Quaternion.Lerp(tf_TopGun.rotation, _lookRotation, 0.2f);
            tf_TopGun.rotation = _rotation;
        }
    }
```

<br>

#### âœˆ ë°œì‚¬

```c#
    private void Attack()
    {
        if (isAttack)
        {
            currentRateOfFire += Time.deltaTime;
            if(currentRateOfFire >= rateOfFire)
            {
                currentRateOfFire = 0;
                anim.SetTrigger("Fire");
                theAudio.Play();
                particle_MuzzleFlash.Play();

                if (Physics.Raycast(tf_TopGun.position,
                                    tf_TopGun.forward + new Vector3(Random.Range(-1, 1f) * rateOfAccuracy, Random.Range(-1, 1f) * rateOfAccuracy, 0f),
                                    out hitInfo,
                                    range,
                                    layerMask)){
                    GameObject _HitEffect = Instantiate(go_HitEffect_Prefab, hitInfo.point, Quaternion.LookRotation(hitInfo.normal));
                    Destroy(_HitEffect, 1f);

                    if (hitInfo.transform.name == "Player")
                    {
                        hitInfo.transform.GetComponent<StatusController>().DecreaseHP(damage);
                    }
                }
            }
        }
    }
```

![image](https://user-images.githubusercontent.com/42318591/102058527-f7b42f80-3e32-11eb-94c3-fd85d6138f3d.png)


***
<br>

    ğŸŒœ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ê²½ìš° 
    ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}